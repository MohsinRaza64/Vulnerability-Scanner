import json
from fuzzywuzzy import fuzz

def get_cpe(product_name, product_version, threshold=80):
    json_file_path = "databases\cpe_database.json"
    try:
        with open(json_file_path, 'r') as file:
            cpe_json = json.load(file)
    except Exception as e:
        print(f"Error loading JSON file: {e}")
        return False

    formatted_product_name = product_name.lower().replace(" ", "_")
    
    for cpe_record in cpe_json:
        cpe_data = cpe_record.get('cpe', {})
        cpe_name = cpe_data.get('cpeName', '')
        
        parts = cpe_name.split(':')
        if len(parts) >= 5:
            cpe_product_name = parts[4]
            cpe_product_version = parts[5]

            if cpe_product_version != "-" and cpe_product_version == product_version:
                similarity_score = fuzz.partial_ratio(formatted_product_name, cpe_product_name)
                if similarity_score >= threshold:
                    return cpe_name

    return False